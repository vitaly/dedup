#!/bin/bash

function die() { echo "$@"; exit 1; }

function usage()
{
  cat <<END
Usage:
  dedup index INDEX DIRECTORY DIRECTORY ...
  dedup find DIRECTORY INDDEX ...
END
  exit
}

function index()
{
  [ -z "$1" -o -z "$2" ] && usage

  local index="$1"; shift

  [ -e "$index" ] && die "$index already exists"

  md5deep -r "$@" > "$index"
}

function args() {
  for a in "$@"; do
    echo -m "$a"
  done
}

function find_dups()
{
  [ -z "$1" -o -z "$2" ] && usage

  local directory="$1"; shift

  [ -d "$directory" ] || die "$directory is not a directory"

  md5deep -rl $(args "$@") $directory
}


cmd="$1"; shift
case "$cmd" in
  index) index "$@";;
  find) find_dups "$@";;
  *) usage;;
esac
